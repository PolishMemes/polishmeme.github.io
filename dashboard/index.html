<!DOCTYPE html>
<html lang="en" dir="ltr">
   <head>
      <meta charset="utf-8">
      <title>Polish Memes - Dashboard</title>
      <link rel="stylesheet" href="/pages/home.css">
      <link rel="stylesheet" href="/dashboard/index.css">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"/>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
   
      <link rel="icon" href="/images/plflag.png">
      <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,600,700,800,900&display=swap" rel="stylesheet">
    
      <link href="https://fonts.googleapis.com/css?family=Montserrat:400,600,700,800,900&display=swap" rel="stylesheet">
      
      <link href="https://fonts.googleapis.com/css?family=Lato:300,400,600,700,800,900&display=swap" rel="stylesheet">

   </head>
   <body onload="loaderFunction()">

      <div id="loader">
          <div class="loading">
          <span></span>
          </div>
      </div>
      <div id="page">
            <nav>
               <div class="logo noselect">
                  <img class="noselect" src="/images/plflag.png"> Polish Memes
               </div>
               <ul class="mainMenu noselect">
                  <li><a class="btn btn-primary">Role: <span id="userRole"></span></a></li>
                  <li class="notifications-dropdown">
                     <a class="active dropdown-toggle" onclick="toggleNotifications()">Notifications</a>
                     <div class="notifications-menu" id="notificationsMenu">
                        <ul class="notifications-list">
                           <li>None</li>
                        </ul>
                     </div>
                  </li>
                  <li><a class="active" href="/dashboard/login.html" class="fas fa-home" onclick="logout()"> Logout</a></li>
               </ul>
         </nav>     
         <div class="content noselect">
            <div class="heading text-center">
               <div id="login">
                  <img id="botLogo" class="noselect" src="/images/plflag2.png" alt="botLogo">
                  <br>
                  <br>
                  <a class="btn btn-secondary" onclick="loginWithDiscord()" role="button"><i class="fab fa-discord"></i> Log in with Discord</a>
               </div>
               <div id="dashboard" style="display: none;">
                  <img id="userAvatar" class="noselect" src="" alt="userAvatar">
                  <p class="title3">Welcome <span id="username"></span>!</p>

                  <!-- Dodane modalne okno -->
                  <div id="uploadModal" class="modal-overlay">
                     <div class="modal">
                        <br>
                        <h2>Send a Meme</h2>
                        <form id="messageForm" onsubmit="sendMessage(event)">
                           <label for="email">Your email:</label>
                           <input type="email" id="email" name="email" required>
                           <br>
                           <label for="message">Your message (max 200 characters):</label>
                           <textarea id="message" name="message" maxlength="200" required></textarea>
                           <br>
                           <button type="submit" class="btn btn-primary">Send</button>
                        </form>
                     </div>
                  </div>
                  <br>
                  <div id="dashboard">
                     <h3 class="rule-list">Before you send a message, please note:</h3>
                     <ul class="subtitle">
                        <p> - Your message can contain a maximum of 200 characters.</p>
                        <p> - We will get back to you as soon as possible!</p>
                     </ul>
                  </div>
               </div>
            </div>
         </div>

      <!-- Poniżej pozostała część kodu -->
      <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
      <script src="/dashboard/loginbutton.js"></script>
      <script src="/dashboard/index.js"></script>
      <script src="/dashboard/login.js"></script>
      <script src="/dashboard/upload_modal.js"></script> <!-- Nowy skrypt dla obsługi modalnego okna -->
      <script>
         function toggleNotifications() {
            const notificationsMenu = document.getElementById('notificationsMenu');
            if (notificationsMenu.style.display === 'block') {
               notificationsMenu.style.display = 'none';
            } else {
               notificationsMenu.style.display = 'block';
            }
         }
      </script>

      <!-- Skrypt dla formularza -->
      <script>
         // Funkcja wykonująca się po zatwierdzeniu formularza
         function sendMessage(event) {
            event.preventDefault();

            // Pobranie wartości z pól formularza
            const form = event.target;
            const email = form.email.value;
            const message = form.message.value;

            // Sprawdzenie, czy wiadomość nie przekracza 200 znaków
            if (message.length > 200) {
               alert('Your message cannot exceed 200 characters.');
               return;
            }

            // Wysłanie formularza za pomocą Fetch API
            fetch('https://formspree.io/f/xpzgwrvk', {
               method: 'POST',
               headers: {
                  'Content-Type': 'application/json'
               },
               body: JSON.stringify({
                  email: email,
                  message: message
               })
            })
            .then(response => {
               if (response.ok) {
                  alert('Message sent successfully!');
                  form.reset();
               } else {
                  alert('Failed to send message. Please try again later.');
               }
            })
            .catch(error => {
               console.error('Error:', error);
               alert('Failed to send message. Please try again later.');
            });
         }

         // Nasłuchiwanie na zdarzenie submit formularza i wywołanie funkcji sendMessage
         const form = document.getElementById('messageForm');
         form.addEventListener('submit', sendMessage);
      </script>

   </body>
</html>